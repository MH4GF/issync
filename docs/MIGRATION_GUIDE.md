# plan-template.md Migration Guide

このドキュメントは、plan-template.mdのバージョン間の変更内容とマイグレーション手順を記録します。

## バージョン管理の方針

- **バージョン番号**: 単純な整数（1, 2, 3...）を使用
- **日付**: バージョン番号と共に日付を併記（例: `<!-- Template Version: 1 (2025-10-15) -->`）
- **マイグレーション**: このガイドを参照して、既存のplan.mdを新しいバージョンに更新

**全バージョン共通のマイグレーション最終ステップ**: 変更適用後、plan.mdのバージョンヘッダー（2行目）を対象バージョンに更新

## Version 1 (2025-10-15)

### 変更内容

**初期バージョン**: 矛盾解消駆動開発ワークフローに最適化されたplan-template.mdの初版

**主な特徴:**
- 11セクション構成（Purpose/Overview、Tasks、Open Questions、Decision Log等）
- 各セクションに記入タイミングガイダンス（HTMLコメント形式）
- 更新ガイドライン（「✅ DO」「❌ DON'T」形式）
- AIガイダンスをHTMLコメント化（人間には非表示）

### マイグレーション手順

初期バージョンのため、マイグレーション手順はありません。

新規プロジェクトで使用する場合:
```bash
issync init --template
```

---

## Version 2 (2025-10-15)

### 変更内容

**Open Questions セクションのカテゴリ構造を削除し、質問をフラットに並べる構造に変更**

**変更セクション**: Open Questions / 残論点
**理由**: カテゴリ構造は小規模プロジェクトで冗長。優先度順配置で重要な問いを見つけやすく

### マイグレーション手順

1. `### [カテゴリX]` 見出しを削除
2. 質問を優先度順に配置

**変更前/後:**
```markdown
# 変更前
### 実装詳細
**Q1: [質問のタイトル]**
### ドキュメント更新・運用
**Q2: [質問のタイトル]**

# 変更後
**Q1: [質問のタイトル]**
**Q2: [質問のタイトル]**
```

---

## Version 3 (2025-10-15)

### 変更内容

**更新ガイドラインをHTMLコメント化**

**変更セクション**: 更新ガイドライン（「## 🚨 このドキュメントの更新ガイドライン（必読）」）
**理由**: AI向けガイダンスをHTMLコメント化し、人間のレビュー時の可読性を向上（AIは引き続き読み取り可能）

### マイグレーション手順

「## 🚨 このドキュメントの更新ガイドライン（必読）」セクション全体を `<!-- -->` で囲む（`---`の前後空行は維持）

---

## Version 4 (2025-10-15)

### 変更内容

**issyncマーカーを追加**

**追加要素**: ファイル先頭に `<!-- issync:v1:start -->`、末尾に `<!-- issync:v1:end -->`
**理由**: issyncがコメントを自動発見できるようにする（GitHub UIでは非表示）

### マイグレーション手順

1. ファイル先頭（Template Version前）に `<!-- issync:v1:start -->` を追加
2. ファイル末尾に `<!-- issync:v1:end -->` を追加

---

## Version 5 (2025-10-16)

### 変更内容

**TasksセクションのGitHub Issue連携ガイダンスをHTMLコメント化**

**変更セクション**: Tasks
**理由**: Version 3と同様 - AI向けガイダンスをHTMLコメント化し、人間のレビュー時の可読性を向上

### マイグレーション手順

AI向けガイダンスHTMLコメント内に「GitHub Issueとの対応」「記法」を移動。タスクリスト自体はHTMLコメント外に残す

---

## Version 6 (2025-10-16)

### 変更内容

**TasksセクションのAIガイダンスを更新 - before-planでのTasks作成を廃止**

**変更セクション**: Tasks
- 記入タイミング: `before-planで初期タスク` → `before-architecture-decisionで初期タスク`
- 重要な注記を追加: 「before-planフェーズではTasksを作成しません」

**理由**: Open Questions解決前のタスク作成は、アーキテクチャ決定により手戻りが発生。確定後にタスク作成でワークフロー最適化

### マイグレーション手順

1. HTMLコメント内の記入タイミングを `before-architecture-decisionで初期タスク` に変更
2. 記入タイミングの次行に重要な注記を追加:
   ```markdown
   **重要**: before-planフェーズではTasksを作成しません。Open Questions解決とアーキテクチャ決定後に、確定した方針に基づいてTasksを作成します。
   ```

**注意**: 既存プロジェクトで既にTasksを記入している場合、そのまま残して構いません

---

## Version 7 (2025-10-17)

### 変更内容

**Inboxセクションを追加 - 人間専用の整理前メモエリア**

**追加セクション**: Inbox（人間が整理前のメモ、リンク、一時的な情報を記入。AIは記入しない）
**理由**: 断片的な情報を一時保管し、各セクションに書き込む前に人間が整理するスクラッチエリアを提供。AI/人間の役割を明確に分離

### マイグレーション手順

`<!-- issync:v1:end -->`の直前に以下を挿入:

```markdown
---

## Inbox

<!--
📝 Guidance for AI
記入タイミング: **人間が記入** - AIは記入しない
記入内容: 整理前のメモ、リンク、一時的な情報など。人間が後で適切なセクションに整理する
-->

[人間が記入する整理前の情報やメモ]
```

**注意**: Inboxは人間専用。整理完了後は適切なセクションに移動し、Inboxから削除を推奨

---

## マイグレーションツールの使用方法

### `/compact-plan` コマンド

plan.mdのバージョンをチェックし、マイグレーションをサポート

**動作**: バージョンヘッダー読み取り → 最新版と比較 → マイグレーション提案 → 承認後実行

### 手動バージョン確認

plan.md先頭行 `<!-- Template Version: X (YYYY-MM-DD) -->` を確認し、最新版と比較

---

## トラブルシューティング

**バージョンヘッダーがない**: plan.md先頭に `<!-- Template Version: 1 (YYYY-MM-DD) -->` を追加し、現在の構造から最も近いバージョンを特定

**マイグレーション失敗**: GitHub Issueのコメント履歴からバックアップを確認し、手動で手順を実施

---

## 更新履歴

- **Version 7 (2025-10-17)**: Inboxセクションを追加（人間専用の整理前メモエリア）
- **Version 6 (2025-10-16)**: TasksセクションのAIガイダンス更新（before-planでの作成を廃止）
- **Version 5 (2025-10-16)**: TasksセクションのGitHub Issue連携ガイダンスをHTMLコメント化
- **Version 4 (2025-10-15)**: issyncマーカーをテンプレートに追加
- **Version 3 (2025-10-15)**: 更新ガイドラインをHTMLコメント化
- **Version 2 (2025-10-15)**: Open Questions セクションのカテゴリ構造を削除
- **Version 1 (2025-10-15)**: 初期バージョン
