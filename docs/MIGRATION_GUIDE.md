# plan-template.md Migration Guide

このドキュメントは、plan-template.mdのバージョン間の変更内容とマイグレーション手順を記録します。

## バージョン管理の方針

- **バージョン番号**: 単純な整数（1, 2, 3...）を使用
- **日付**: バージョン番号と共に日付を併記（例: `<!-- Template Version: 1 (2025-10-15) -->`）
- **マイグレーション**: このガイドを参照して、既存のplan.mdを新しいバージョンに更新

## Version 1 (2025-10-15)

### 変更内容

**初期バージョン**: 矛盾解消駆動開発ワークフローに最適化されたplan-template.mdの初版

**構成（11セクション）:**
1. Purpose / Overview
2. Context & Direction
3. Validation & Acceptance Criteria
4. Specification / 仕様
5. Tasks
6. Open Questions / 残論点
7. Follow-up Issues / フォローアップ課題
8. Discoveries & Insights
9. Decision Log
10. Outcomes & Retrospectives
11. Deliverables & Notes

**主な特徴:**
- 各セクションに記入タイミングガイダンス（HTMLコメント形式）
- 更新ガイドライン（「✅ DO」「❌ DON'T」形式）
- Work Planセクションを削除し、Tasksセクションに統合
- AIガイダンスをHTMLコメント化（人間には非表示）

### マイグレーション手順

初期バージョンのため、マイグレーション手順はありません。

新規プロジェクトで使用する場合:
```bash
issync init --template
```

---

## Version 2 (2025-10-15)

### 変更内容

**概要**: Open Questions セクションのカテゴリ構造を削除し、質問をフラットに並べる構造に変更

**変更されたセクション:**
- **Open Questions / 残論点**: カテゴリ見出し（`### [カテゴリX]`）を削除し、質問を直接セクション内に配置する構造に変更

**理由:**
- カテゴリ構造は小規模なプロジェクトでは冗長であり、保守コストが高い
- 質問の優先度順に並べることで、実装者が重要な問いを見つけやすくなる
- テンプレートのシンプルさを維持し、プロジェクト間の一貫性を向上

### マイグレーション手順

#### 手動マイグレーション

既存のplan.mdのOpen Questionsセクションをバージョン2に移行する手順:

1. **カテゴリ見出しの削除**: `### [カテゴリ1]`, `### [カテゴリ2]` などの見出しを削除
2. **質問の再配置**: 質問（`**Q1: [質問のタイトル]**`）を優先度順に並べる
3. **バージョンヘッダーの更新**: ファイル先頭の `<!-- Template Version: 1 (YYYY-MM-DD) -->` を `<!-- Template Version: 2 (2025-10-15) -->` に変更

**変更前:**
```markdown
## Open Questions / 残論点

### 実装詳細

**Q1: [質問のタイトル]**
- [質問の詳細]

### ドキュメント更新・運用

**Q2: [質問のタイトル]**
- [質問の詳細]
```

**変更後:**
```markdown
## Open Questions / 残論点

**Q1: [質問のタイトル]**
- [質問の詳細]

**Q2: [質問のタイトル]**
- [質問の詳細]
```

**注意事項:**
- カテゴリ情報は削除されますが、質問の内容や順序は維持してください
- 優先度が高い（先に解消すべき）質問を上に配置することを推奨します

---

## Version 3 (2025-10-15)

### 変更内容

**概要**: 更新ガイドラインをHTMLコメント化し、人間のレビュー時の可読性を向上

**変更されたセクション:**
- **更新ガイドライン**: 「## 🚨 このドキュメントの更新ガイドライン（必読）」セクション全体をHTMLコメント（`<!-- -->`）で囲み、人間には非表示に

**理由:**
- 人間がGitHub Issueでplan.mdを閲覧する際、AI向けガイダンスは視覚的なノイズとなり可読性を損なう
- HTMLコメント化により人間のレビュー時の可読性を最大化しつつ、AIエージェントは引き続き読み取り可能
- 他のセクションのAIガイダンスと統一した形式に（全てHTMLコメント化）

### マイグレーション手順

#### 手動マイグレーション

既存のplan.mdをバージョン3に移行する手順:

1. **更新ガイドラインのHTMLコメント化**: 「## 🚨 このドキュメントの更新ガイドライン（必読）」セクション全体（見出しから最後の`---`の直前まで）を `<!-- -->` で囲む
2. **バージョンヘッダーの更新**: ファイル先頭の `<!-- Template Version: 2 (2025-10-15) -->` を `<!-- Template Version: 3 (2025-10-15) -->` に変更

**変更前:**
```markdown
この実行計画は生きたドキュメントです。新しい情報が出るたびに各セクションを更新してください。各セクションは、事前知識のない初めての貢献者へのガイダンスとして扱ってください。

---

## 🚨 このドキュメントの更新ガイドライン（必読）

**基本原則:**
- **簡潔さ重視**: 各セクションは必要最小限の情報のみを記載
- **段階的更新**: 変更が必要な部分のみを更新し、複数セクションの大幅な書き換えは避ける
- **冗長性の排除**: 重複する説明や過度な詳細化を避ける

**✅ DO（推奨）:**
- 特定のセクションのみを対象とした、必要最小限の変更
...

**具体例:**
```markdown
✅ GOOD: "Tasksセクションに新しいタスク「X実装」を追加"
❌ BAD: "Tasksセクションを見直し、全タスクの説明を詳細化し、背景情報を追加"
...
\```

---

## Purpose / Overview
```

**変更後:**
```markdown
この実行計画は生きたドキュメントです。新しい情報が出るたびに各セクションを更新してください。各セクションは、事前知識のない初めての貢献者へのガイダンスとして扱ってください。

<!--
## 🚨 このドキュメントの更新ガイドライン（必読）

**基本原則:**
- **簡潔さ重視**: 各セクションは必要最小限の情報のみを記載
- **段階的更新**: 変更が必要な部分のみを更新し、複数セクションの大幅な書き換えは避ける
- **冗長性の排除**: 重複する説明や過度な詳細化を避ける

**✅ DO（推奨）:**
- 特定のセクションのみを対象とした、必要最小限の変更
...

**具体例:**
```markdown
✅ GOOD: "Tasksセクションに新しいタスク「X実装」を追加"
❌ BAD: "Tasksセクションを見直し、全タスクの説明を詳細化し、背景情報を追加"
...
\```
-->

---

## Purpose / Overview
```

**注意事項:**
- 更新ガイドラインセクション全体をHTMLコメントで囲んでください（`---`の前後の空行は維持）
- セクションの内容自体は変更せず、コメント化のみを行ってください

---

## Version 3 以降のマイグレーション例

（将来のバージョンアップ時に、以下の形式で追加されます）

```markdown
## Version X (YYYY-MM-DD)

### 変更内容

**概要**: [変更の概要]

**追加されたセクション:**
- [新セクション名]: [説明]

**削除されたセクション:**
- [旧セクション名]: [理由]

**変更されたセクション:**
- [セクション名]: [変更内容]

### マイグレーション手順

#### 自動マイグレーション（推奨）

`/compact-plan`コマンドを実行すると、バージョン差分を検出し、マイグレーション提案が表示されます:

```bash
/compact-plan
```

#### 手動マイグレーション

1. [ステップ1の説明]
2. [ステップ2の説明]
3. [ステップ3の説明]

**注意事項:**
- [重要な注意点]
```

---

## マイグレーションツールの使用方法

### `/compact-plan` コマンド

`/compact-plan`コマンドは、plan.mdのバージョンをチェックし、必要に応じてマイグレーションをサポートします。

**動作:**
1. plan.mdのバージョンヘッダーを読み取り
2. 最新のplan-template.mdバージョンと比較
3. バージョンが古い場合、マイグレーション提案を表示
4. ユーザーの承認後、自動マイグレーションを実行

**実行例:**
```
/compact-plan

> ⚠️ plan.mdのバージョンが古い可能性があります
> 現在のバージョン: Version 1 (2025-10-15)
> 最新のバージョン: Version 3 (2025-11-01)
>
> マイグレーションが必要です。詳細はMIGRATION_GUIDE.mdを参照してください。
> マイグレーションを実行しますか？ (yes/no)
```

### 手動でのバージョン確認

plan.mdの先頭行を確認:
```markdown
<!-- Template Version: 1 (2025-10-15) -->
```

最新のplan-template.mdのバージョンと比較し、差異がある場合はこのガイドを参照してマイグレーションを実施してください。

---

## トラブルシューティング

### バージョンヘッダーがない場合

古いplan.mdにはバージョンヘッダーがない可能性があります。その場合:

1. plan.mdの先頭に以下を追加:
```markdown
<!-- Template Version: 1 (YYYY-MM-DD) -->
```

2. 現在のplan.mdの構造を確認し、最も近いバージョン番号を特定
3. 必要に応じてマイグレーションを実施

### マイグレーションの失敗

マイグレーションが失敗した場合:

1. plan.mdのバックアップを確認（issyncによりGitHub Issueに保存されています）
2. 手動でマイグレーション手順を実施
3. `/compact-plan`を再実行して検証

---

## 更新履歴

- **Version 3 (2025-10-15)**: 更新ガイドラインをHTMLコメント化
- **Version 2 (2025-10-15)**: Open Questions セクションのカテゴリ構造を削除
- **Version 1 (2025-10-15)**: 初期バージョン
