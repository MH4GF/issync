---
description: 進捗ドキュメント内のOpen Questionsを解消し、Decision LogやSpecificationセクションを自動更新。ユーザーがARGUMENTS形式で各質問への意思決定を入力し、LLMがそれを進捗ドキュメントに反映
---

# /resolve-questions: Open Questions解消コマンド

あなたは進捗ドキュメント内のOpen Questionsを解消し、Decision LogやSpecificationセクションを自動更新するサポートをしています。このコマンドは以下のワークフローを自動化します：
1. 進捗ドキュメントのOpen Questionsセクションを読み込み
2. ユーザーが指定した各Qの意思決定を解析
3. Open Questionsセクションで該当質問を取り消し線でマーク + "✅ 解決済み (YYYY-MM-DD)" 追加
4. 決定内容を「**決定**: <内容>」として質問の下に追記
5. Decision Logセクションに構造化された決定記録を追加
6. Specificationセクションを自動更新（必要に応じて）
7. Editツールで進捗ドキュメントを更新
8. `issync push` で同期

## 使用方法

```bash
/resolve-questions
Q1-2: 推奨案
Q3: <ユーザーの意思決定を自然文で記載>
Q4: 推奨案
Q5-6: 推奨案
```

**引数形式**:
- 各行に `Q[番号または範囲]: [意思決定内容]` を記載
- 範囲指定可能: `Q1-3: 推奨案` で Q1, Q2, Q3 すべてに適用
- 意思決定内容:
  - `推奨案` または `推奨` と記載した場合、Open Questionsの検討案から推奨マーク付きの案を採用
  - それ以外の場合、記載内容をそのまま決定内容として使用

## コンテキスト

このコマンドは「矛盾解消駆動開発」ワークフローの**横断的オペレーション**です：
- **実行タイミング**: どのステートでも使用可能（plan, poc, architecture-decision, implement）
- Open Questionsの解消を一貫したフォーマットで実現
- Decision Logへの記録漏れを防止
- Specificationセクションの構造化された更新を支援

## 前提条件

プロジェクト全体の前提条件は`README.md`を参照。このコマンド固有の前提条件:
- 進捗ドキュメントが既に作成されている（`/issync:plan`実行済み）
- Open Questionsセクションに未解決の質問が存在する
- `GITHUB_TOKEN`環境変数が設定されている

## 実行ステップ

### ステップ1: 進捗ドキュメントの読み込み

まず、`/understand-progress`コマンドを内部で呼び出して、進捗ドキュメントを読み込みます。

```bash
/understand-progress
```

### ステップ2: Open Questionsセクションの確認

読み込んだ進捗ドキュメントから、Open Questionsセクションを確認してください：

- 未解決の質問（取り消し線がないもの）をすべて抽出
- 各質問の番号（Q1, Q2, ...）を特定
- 検討案がある場合は推奨マーク（推奨、推奨案、自信度:高🟢など）を確認

### ステップ3: ユーザー入力の解析

コマンド実行時に指定された引数から、各質問への意思決定を解析してください：

**入力パターン例:**
```
Q1-2: 推奨案
Q3: コマンドのARGUMENTSとしてユーザーが意思決定を各Qごとに行う方式を採用
Q4: 推奨案
```

**解析ロジック:**
1. 各行を解析し、質問番号と意思決定内容を抽出
2. 範囲指定（例: `Q1-3`）の場合、範囲内のすべての質問に適用
3. `推奨案`または`推奨`が指定された場合:
   - Open Questionsの該当質問から推奨マーク付きの検討案を抽出
   - 推奨マークが見つからない場合は、最初の検討案を採用
4. その他の場合、指定された内容をそのまま決定内容として使用

### ステップ4: Open Questionsセクションの更新

各質問について、以下の形式で更新してください：

**変更前:**
```markdown
**Q1: コマンド名の決定**

- `/issync:resolve-questions` か `/issync:resolve` か？

**検討案:**
- **`/issync:resolve-questions`（推奨 自信度:高🟢）**: 明確な意図伝達
- **`/issync:resolve`**: 簡潔だが不明確
```

**変更後:**
```markdown
~**Q1: コマンド名の決定**~ ✅ 解決済み (YYYY-MM-DD)

- `/issync:resolve-questions` か `/issync:resolve` か？

**検討案:**
- **`/issync:resolve-questions`（推奨 自信度:高🟢）**: 明確な意図伝達
- **`/issync:resolve`**: 簡潔だが不明確

**決定**: `/issync:resolve-questions` を採用
```

**重要ポイント:**
- 質問タイトル全体を取り消し線（~テキスト~）でマーク
- 取り消し線の直後に ` ✅ 解決済み (YYYY-MM-DD)` を追加（YYYY-MM-DDは今日の日付）
- 質問文、検討案はそのまま保持
- 最後に `**決定**: <内容>` を追加

### ステップ5: Decision Logセクションへの記録

解消した質問を、関連する意思決定ごとにグループ化し、Decision Logセクションに追加してください。

**フォーマット:**
```markdown
**YYYY-MM-DD: <決定のタイトル>**

**採用**: <採用した選択肢>

**理由**:
- <理由1>
- <理由2>

**比較検討した候補**:
- <候補1>: <却下理由>
- <候補2>: <却下理由>

**トレードオフ**: <採用案のトレードオフ>
```

**グループ化の指針:**
- 関連する質問（技術スタック選定、設計方針など）はまとめて1つのDecision Logエントリにする
- 1つの質問が独立した決定の場合は単独でエントリを作成
- 各エントリには必ず「採用」「理由」「比較検討した候補」「トレードオフ」を含める

**Decision Logエントリの作成手順:**
1. Open Questionsの質問と検討案から、採用案・却下案・理由・トレードオフを抽出
2. 検討案に記載がない場合は、ユーザーの意思決定内容から推論
3. Decision Logセクションの最後に追加（既存エントリの後ろ）

### ステップ6: Specificationセクションの更新

Open Questionsの解決内容から、仕様を推論してSpecificationセクションを更新してください。

**更新対象:**
- コマンドインターフェース（引数、オプション、動作仕様）
- データフォーマット（入出力形式、ファイル構造）
- アーキテクチャ決定（技術スタック、設計パターン）
- 動作フロー（処理ステップ、エラーハンドリング）

**更新方針:**
- 既存のSpecificationセクションに追記（上書きしない）
- 見出し（###）で階層化し、構造化された記述を維持
- 解決した質問の内容が既存の仕様と矛盾する場合は、既存部分を更新
- 明確な仕様が推論できない場合は、Specificationセクションの更新をスキップ

**例:**
Q1で「コマンド名は`/issync:resolve-questions`」と決定した場合:
```markdown
### コマンドインターフェース

**コマンド名**: `/issync:resolve-questions`

**引数形式**:
...
```

### ステップ7: 進捗ドキュメントの更新

Editツールを使用して、進捗ドキュメントを更新してください。

**更新箇所:**
1. Open Questionsセクション: 各質問に取り消し線 + 解決済みマーク + 決定内容
2. Decision Logセクション: 新しいDecision Logエントリを追加
3. Specificationセクション: 仕様を追記または更新

**注意事項:**
- Editツールは1回の呼び出しで1箇所のみ更新可能
- 複数箇所を更新する場合は、Editツールを複数回呼び出す
- `old_string`が一意になるよう、十分なコンテキストを含める

### ステップ8: issync pushによる同期

進捗ドキュメントの変更をGitHub Issueに同期してください。

```bash
issync push
```

## 出力フォーマット

更新完了後、以下のサマリーを出力:

```markdown
## /resolve-questions 実行結果

✅ Open Questions解消が完了しました

### 解消した質問
- Q1: <質問タイトル> → <決定内容>
- Q2: <質問タイトル> → <決定内容>
- ...

### 更新内容
- ✅ Open Questionsセクション: [X]件の質問を解決済みとしてマーク
- ✅ Decision Logセクション: [Y]件の決定記録を追加
- ✅ Specificationセクション: [更新あり / 更新なし]
- ✅ GitHub Issueへの同期: 完了（issync push）

### 次のアクション
- [ ] Decision Logの内容を確認してください
- [ ] Specificationセクションが正しく更新されているか確認してください
- [ ] 残りのOpen Questionsがあれば、引き続き解消を進めてください
```

## 重要な注意事項

1. **ユーザー主導の意思決定**: 自動推論ではなく、ユーザーがARGUMENTSで明示的に意思決定を入力
2. **推奨案の優先**: `推奨案`と指定された場合、Open Questionsの検討案から推奨マーク付きの案を自動抽出
3. **一貫したフォーマット維持**: 取り消し線 + "✅ 解決済み (YYYY-MM-DD)" による統一されたマーキング
4. **Decision Logへの構造化記録**: 「採用」「理由」「比較検討した候補」「トレードオフ」を含める
5. **Specification更新の自律性**: Claude Codeの自律性を活かし、仕様を推論して記載
6. **issync連携**: 作業後は`issync push`で同期

## エラーハンドリング

**Open Questionsが存在しない場合**:
- 「Open Questionsセクションに未解決の質問が見つかりませんでした」と表示
- 処理を終了

**指定された質問番号が存在しない場合**:
- 警告を表示: 「Q[番号] は存在しません。スキップします。」
- 他の質問の処理は継続

**推奨案が見つからない場合**:
- 検討案の最初の項目を採用
- 検討案がない場合は、ユーザーの入力をそのまま決定内容として使用

**issync push失敗時**:
- エラーメッセージを表示
- ローカルの進捗ドキュメントは更新済みであることを伝える
- 手動で `issync push` を実行するよう案内

## 実行例

```bash
/resolve-questions
Q1-2: 推奨案
Q3: コマンドのARGUMENTSとしてユーザーが意思決定を各Qごとに行う
Q4: 推奨案
Q5: テスト不要。問題があれば別issueで調整する
Q6: 推奨案
```

実行フローは冒頭のワークフロー（ステップ1-8）を参照。

## 運用フロー

1. `/issync:plan`で進捗ドキュメント作成（Open Questionsが生成される）
2. 開発を進める中で、Open Questionsへの回答が明確になる
3. `/resolve-questions`で一括解消（Decision Log記録 + Specification更新）
4. 残りのOpen Questionsがあれば、引き続き解消を進める
5. すべてのOpen Questionsが解消されたら、次のフェーズ（実装など）へ進む
