---
description: plan-template.md更新時にMIGRATION_GUIDE.mdの新エントリを半自動生成
---

# /upgrade-plan-template: テンプレート更新とマイグレーションガイド生成

あなたは @plan-template.md の更新をサポートし、 @MIGRATION_GUIDE.md の新しいバージョンエントリを半自動で生成します。このコマンドは以下のワークフローを自動化します：
1. plan-template.mdの変更内容の分析
2. MIGRATION_GUIDE.mdへの新バージョンエントリの追加
3. バージョン番号の更新

## コンテキスト

このコマンドはplan-template.mdのバージョン管理を支援します：
- plan-template.mdは矛盾解消駆動開発の中核的インターフェース
- テンプレート変更時には既存プロジェクトへのマイグレーション手順が必要
- 完全手動では運用コストが高く、完全自動では説明が不十分
- AIによる初期ドラフト生成 + 人間のレビューで品質と効率のバランスを取る

## 実行タイミング

plan-template.mdを更新したい時に実行します。ユーザーからどのように更新したいかを聞き、plan-template.mdを更新し、その後MIGRATION_GUIDE.mdに新エントリを生成します。

## 前提条件

- ユーザーがplan-template.mdの更新内容を説明できる
- 現在のバージョン番号を知っている、または最新のバージョン情報を確認できる

## 実行ステップ

### ステップ1: 現在のバージョン情報を確認

1. **plan-template.mdのバージョンヘッダーを確認**
   - ファイルの先頭行 `<!-- Template Version: X (YYYY-MM-DD) -->` からバージョン番号を取得

2. **MIGRATION_GUIDE.mdの最新バージョンを確認**
   - 最新のバージョンエントリを確認し、次のバージョン番号を決定

3. **ユーザーに新バージョン番号を確認**
   - 「現在のバージョン: X、新しいバージョン: X+1 でよろしいですか？」

### ステップ2: 変更内容を分析

1. **git diffで差分を取得**
   ```bash
   git diff HEAD -- docs/plan-template.md
   ```

2. **変更内容を分類**
   - 追加されたセクション
   - 削除されたセクション
   - 変更されたセクション（内容の修正、構造の変更等）

3. **変更の影響を分析**
   - 既存のplan.mdファイルに対するマイグレーション手順が必要か
   - どのような手順が必要か（手動操作、構造変更、内容追加等）

### ステップ3: MIGRATION_GUIDE.mdの新エントリを生成

MIGRATION_GUIDE.mdに以下の形式で新しいバージョンエントリを追加：

```markdown
## Version X (YYYY-MM-DD)

### 変更内容

**概要**: [変更の概要を1-2文で記述]

**追加されたセクション:**
- [新セクション名]: [説明]

**削除されたセクション:**
- [旧セクション名]: [削除理由]

**変更されたセクション:**
- [セクション名]: [変更内容の説明]

**理由:**
- [変更の背景や目的]

### マイグレーション手順

#### 手動マイグレーション

既存のplan.mdをバージョンXに移行する手順:

1. [ステップ1の説明]
2. [ステップ2の説明]
3. [ステップ3の説明]

**変更前:**
```markdown
[変更前のコード例]
```

**変更後:**
```markdown
[変更後のコード例]
```

**注意事項:**
- [重要な注意点]

---
```

### ステップ4: plan-template.mdのバージョンヘッダーを更新

plan-template.mdの先頭行を新しいバージョン番号と日付に更新：

```markdown
<!-- Template Version: X (YYYY-MM-DD) -->
```

### ステップ5: レビューと確認

生成した内容をユーザーに提示し、確認を求める：

1. **変更内容のサマリー**
2. **生成したMIGRATION_GUIDE.mdエントリ**
3. **更新したバージョンヘッダー**

ユーザーの承認後、ファイルを更新します。

## 出力フォーマット

更新完了後、以下の形式でサマリーを提供：

```markdown
## /upgrade-plan-template 実行結果

### 更新内容
- ✅ plan-template.mdのバージョンを X → Y に更新 (docs/plan-template.md:1)
- ✅ MIGRATION_GUIDE.mdに Version Y のエントリを追加 (docs/MIGRATION_GUIDE.md:[line_number])

### 変更サマリー
- **追加されたセクション**: [セクション名一覧]
- **削除されたセクション**: [セクション名一覧]
- **変更されたセクション**: [セクション名一覧]

### 次のアクション
- [ ] MIGRATION_GUIDE.mdの内容をレビューし、必要に応じて編集してください
- [ ] マイグレーション手順が明確で実行可能か確認してください
- [ ] 変更をコミットしてください
```

## 重要な注意事項

- 変更を行う前に**必ずplan-template.mdとMIGRATION_GUIDE.mdを読んでください**
- **git diffを使用**して実際の変更内容を正確に把握してください
- マイグレーション手順は**具体的で実行可能**な形式で記述してください
- **変更前/変更後のコード例**を必ず含めてください
- ユーザーの承認なしに**ファイルを更新しないでください**
- バージョン番号は**整数で連番**です（1, 2, 3...）
- 日付は**YYYY-MM-DD形式**で今日の日付を使用してください

## 実行例

**ユーザー:** `/upgrade-plan-template`

**アシスタント:** "plan-template.mdの更新をサポートします。

まず、現在の状態を確認します。"

[plan-template.mdとMIGRATION_GUIDE.mdを読み、git diffで差分を確認]

**アシスタント:** "plan-template.mdの変更を検出しました。

- 現在のバージョン: 2 (2025-10-15)
- 提案する新バージョン: 3 (2025-10-15)

検出された変更:
- 更新ガイドラインセクションをHTMLコメント化
- Purpose / Overviewセクションのガイダンスを追加

この内容でMIGRATION_GUIDE.mdのエントリを生成しますか？"

**ユーザー:** "はい"

**アシスタント:** [MIGRATION_GUIDE.mdに新エントリを生成、plan-template.mdのバージョンを更新、サマリーを提示]

## エラーハンドリング

以下の場合はエラーを報告してユーザーにガイダンスを求めます：

- **git diffで差分が見つからない場合**: "plan-template.mdに変更が検出されませんでした。先にplan-template.mdを編集してください。"
- **バージョンヘッダーが見つからない場合**: "plan-template.mdのバージョンヘッダーが見つかりません。手動で追加してください。"
- **MIGRATION_GUIDE.mdが存在しない場合**: "MIGRATION_GUIDE.mdが見つかりません。新規作成しますか？"
